<nav class="bg-[#006747] flex items-center justify-between px-6 py-4 relative">
  <div class="flex items-center space-x-4">
    <%= image_tag "USF.png", alt: "University of South Florida", class: "h-10 w-auto" %> 
  </div>

  <h1 class="absolute left-1/2 transform -translate-x-1/2 text-white font-bold text-xl">
    Admin Dashboard - Ride Queues
  </h1>

  <div class="flex items-center space-x-4">
    <%= link_to "New Ride", new_ride_request_path, class: "text-white hover:underline font-semibold" %>
    <%= link_to "Ride History", ride_requests_path, method: :delete, class: "text-white hover:underline font-semibold" %>
    <%= link_to "Log Out", logout_path, method: :delete, class: "text-white hover:underline font-semibold" %>
  </div>
</nav>


<div class="bg-white min-h-screen p-8">
  <div class="flex justify-end mb-6">
    <label for="team-filter" class="text-gray-700 font-semibold mr-2 self-center">Filter by Team:</label>
    <select id="team-filter" class="px-4 py-2 border rounded-md">
      <option value="all">All Teams</option>
      <% @ride_requests.map { |r| r.team&.name || "No Team Assigned" }.uniq.sort.each do |team_name| %>
        <option value="<%= team_name.parameterize %>"><%= team_name %></option>
      <% end %>
    </select>
  </div>

  
  <% if @ride_requests.present? %>
    <% @ride_requests.includes(:team).group_by { |r| r.team&.name || "No Team Assigned" }
      .sort_by { |team_name, _rides| team_name }
      .each do |team_name, rides| %>

      <div class="team-section mb-12" data-team="<%= team_name.parameterize %>">
        <h2 class="text-2xl font-bold text-gray-800 mb-4"><%= team_name %></h2>

        <div class="overflow-x-auto shadow rounded-lg">
          <table class="min-w-full table-auto border border-gray-300">
            <thead>
              <tr class="bg-[#006747] text-white text-left">
                <th class="py-3 px-4">Name</th>
                <th class="py-3 px-4">Phone</th>
                <th class="py-3 px-4">Pickup</th>
                <th class="py-3 px-4">Destination</th>
                <th class="py-3 px-4">Requested At</th>
                <th class="py-3 px-4 text-center">Action</th>
              </tr>
            </thead>

            <tbody class="text-gray-700 bg-white">
              <% rides.each do |ride| %>
                <tr class="border-b hover:bg-green-100">
                  <td class="py-3 px-4"><%= ride.name %></td>
                  <td class="py-3 px-4"><%= ride.phone %></td>
                  <td class="py-3 px-4"><%= ride.location %></td>
                  <td class="py-3 px-4"><%= ride.destination %></td>
                  <td class="py-3 px-4">
                    <%= ride.created_at.in_time_zone("Eastern Time (US & Canada)").strftime("%b %d, %Y %I:%M %p %Z") %>
                  </td>
                  <td class="py-3 px-4">
                    <div class="flex justify-end space-x-2">
                      <%= button_to "OTW", notify_on_the_way_ride_request_path(ride), method: :post, class: "bg-[#006747] hover:bg-green-600 text-white font-semibold py-1 px-3 rounded text-xs" %>
                      <%= button_to "Arrived", notify_arrived_ride_request_path(ride), method: :post, class: "bg-[#006747] hover:bg-green-600 text-white font-semibold py-1 px-3 rounded text-xs" %>
                      <%= button_to "Complete", complete_ride_request_path(ride), method: :post, data: { confirm: "Are you sure you want to complete this ride?" }, class: "bg-[#006747] hover:bg-green-600 text-white font-semibold py-1 px-3 rounded text-xs" %>
                      <%= button_to ride_request_path(ride), method: :delete, data: { confirm: "Are you sure you want to delete this ride?" }, class: "bg-gray-400 hover:bg-gray-500 text-white font-semibold py-1 px-2 rounded" do %>
                        <i class="fas fa-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="text-center text-gray-600">No ride requests found.</p>
  <% end %>
</div>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const teamFilter = document.getElementById('team-filter');
    const teamSections = document.querySelectorAll('.team-section');

    teamFilter.addEventListener('change', (e) => {
      const selected = e.target.value;
      teamSections.forEach(section => {
        if (selected === 'all' || section.dataset.team === selected) {
          section.style.display = '';
        } else {
          section.style.display = 'none';
        }
      });
    });
  });
</script>
